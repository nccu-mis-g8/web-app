{"ast":null,"code":"import{useState,useEffect}from\"react\";import default_avatar200 from\"../../images/default_avatar200.png\";import image from\"../../images/image.png\";import image_library from\"../../images/image_library.png\";import classes from\"./UserInfoAvatar.module.css\";import{getUserAvatar}from\"../../utils/userInfoUtils\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function UserInfoMainFrame(){const[selectedFile,setSelectedFile]=useState(null);const[showOption,setShowOption]=useState(false);const[showModal,setShowModal]=useState(false);const[userAvatar,setUserAvatar]=useState(default_avatar200);const userId=localStorage.getItem(\"userId\");const lastName=localStorage.getItem(\"lastName\");const firstName=localStorage.getItem(\"firstName\");const name=lastName+firstName;const account=localStorage.getItem(\"account\");useEffect(()=>{async function fetchUserAvatar(){const avatarUrl=await getUserAvatar();if(avatarUrl){setUserAvatar(avatarUrl);}else{setUserAvatar(default_avatar200);}}fetchUserAvatar();},[]);function avatarClickHandler(){setShowOption(!showOption);}function viewModalHandler(){setShowModal(true);setShowOption(false);}function closeModalHandler(){setShowModal(false);}function changeAvatarHandler(){setShowOption(false);document.getElementById(\"fileInput\").click();}async function fileChangeHandler(event){const file=event.target.files[0];if(!file){return;}setSelectedFile(file);const formData=new FormData();const userInfo=JSON.stringify({user_Id:userId});formData.append(\"user_info\",userInfo);formData.append(\"file\",file);try{const response=await fetch(\"http://127.0.0.1:5001/userinfo/user/upload_photo\",{method:\"POST\",body:formData});console.log(response);if(response.status===200){console.log(\"上傳成功\");alert(\"上傳成功!\");const responseUrl=await getUserAvatar();if(responseUrl){setUserAvatar(responseUrl);}else{alert(\"重載大頭貼時發生錯誤，請稍後再試\");}}else if(response.status===400){const responseData=await response.json();const error=responseData.message;console.log(\"錯誤訊息\"+error);alert(\"請上傳正確格式的圖片\");}else{const responseData=await response.json();const error=responseData.message;console.error(error);alert(\"發生錯誤，請重新整理後再試一次\");}}catch(error){console.error(\"Error: \",error);}}return/*#__PURE__*/_jsxs(\"div\",{className:classes.avatarContainer,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.avatarWrapper,children:[/*#__PURE__*/_jsx(\"img\",{src:userAvatar,alt:\"\\u982D\\u50CF\",className:classes.avatar}),/*#__PURE__*/_jsx(\"div\",{className:classes.overlay,onClick:avatarClickHandler,children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-pen\"})}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:\"fileInput\",accept:\"image/*\",style:{display:\"none\"},onChange:fileChangeHandler}),showOption&&/*#__PURE__*/_jsxs(\"div\",{className:classes.avatarOptions,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.buttonContainer,children:[/*#__PURE__*/_jsx(\"img\",{src:image,alt:\"\\u67E5\\u770B\"}),/*#__PURE__*/_jsx(\"button\",{className:classes.button,onClick:viewModalHandler,children:\"\\u67E5\\u770B\\u5927\\u982D\\u8CBC\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.buttonContainer,children:[/*#__PURE__*/_jsx(\"img\",{src:image_library,alt:\"\\u66F4\\u63DB\"}),/*#__PURE__*/_jsx(\"button\",{className:classes.button,onClick:changeAvatarHandler,children:\"\\u66F4\\u63DB\\u5927\\u982D\\u8CBC\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:classes.name,children:name}),/*#__PURE__*/_jsx(\"div\",{className:classes.account,children:account}),showModal&&/*#__PURE__*/_jsx(\"div\",{className:classes.modal,onClick:closeModalHandler,children:/*#__PURE__*/_jsxs(\"div\",{className:classes.modalContent,onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"img\",{src:default_avatar200,alt:\"\\u982D\\u50CF\",className:classes.largeAvatar}),/*#__PURE__*/_jsx(\"span\",{className:classes.closeButton,onClick:closeModalHandler,children:\"\\xD7\"})]})})]});}export default UserInfoMainFrame;","map":{"version":3,"names":["useState","useEffect","default_avatar200","image","image_library","classes","getUserAvatar","jsx","_jsx","jsxs","_jsxs","UserInfoMainFrame","selectedFile","setSelectedFile","showOption","setShowOption","showModal","setShowModal","userAvatar","setUserAvatar","userId","localStorage","getItem","lastName","firstName","name","account","fetchUserAvatar","avatarUrl","avatarClickHandler","viewModalHandler","closeModalHandler","changeAvatarHandler","document","getElementById","click","fileChangeHandler","event","file","target","files","formData","FormData","userInfo","JSON","stringify","user_Id","append","response","fetch","method","body","console","log","status","alert","responseUrl","responseData","json","error","message","className","avatarContainer","children","avatarWrapper","src","alt","avatar","overlay","onClick","type","id","accept","style","display","onChange","avatarOptions","buttonContainer","button","modal","modalContent","e","stopPropagation","largeAvatar","closeButton"],"sources":["C:/Users/user/Desktop/gp-web-app/frontend/src/components/userInfo/UserInfoAvatar.js"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport default_avatar200 from \"../../images/default_avatar200.png\";\r\nimport image from \"../../images/image.png\";\r\nimport image_library from \"../../images/image_library.png\";\r\nimport classes from \"./UserInfoAvatar.module.css\";\r\nimport { getUserAvatar } from \"../../utils/userInfoUtils\";\r\n\r\nfunction UserInfoMainFrame() {\r\n    const [selectedFile, setSelectedFile] = useState(null);\r\n    const [showOption, setShowOption] = useState(false);\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [userAvatar, setUserAvatar] = useState(default_avatar200);\r\n\r\n    const userId = localStorage.getItem(\"userId\");\r\n    const lastName = localStorage.getItem(\"lastName\");\r\n    const firstName = localStorage.getItem(\"firstName\");\r\n    const name = lastName + firstName;\r\n    const account = localStorage.getItem(\"account\");\r\n\r\n    useEffect(() => {\r\n        async function fetchUserAvatar() {\r\n            const avatarUrl = await getUserAvatar();\r\n            if (avatarUrl) {\r\n                setUserAvatar(avatarUrl);\r\n            } else {\r\n                setUserAvatar(default_avatar200);\r\n            }\r\n        }\r\n        fetchUserAvatar();\r\n    }, [])\r\n\r\n    function avatarClickHandler() {\r\n        setShowOption(!showOption);\r\n    }\r\n\r\n    function viewModalHandler() {\r\n        setShowModal(true);\r\n        setShowOption(false);\r\n    }\r\n\r\n    function closeModalHandler() {\r\n        setShowModal(false);\r\n    }\r\n\r\n    function changeAvatarHandler() {\r\n        setShowOption(false);\r\n        document.getElementById(\"fileInput\").click();\r\n    }\r\n\r\n    async function fileChangeHandler(event) {\r\n        const file = event.target.files[0];\r\n        if (!file) {\r\n            return;\r\n        }\r\n        setSelectedFile(file);\r\n\r\n        const formData = new FormData();\r\n        const userInfo = JSON.stringify({ user_Id: userId });\r\n        formData.append(\"user_info\", userInfo);\r\n        formData.append(\"file\", file);\r\n\r\n        try {\r\n            const response = await fetch(\r\n                \"http://127.0.0.1:5001/userinfo/user/upload_photo\",\r\n                {\r\n                    method: \"POST\",\r\n                    body: formData,\r\n                }\r\n            );\r\n\r\n            console.log(response);\r\n\r\n            if (response.status === 200) {\r\n                console.log(\"上傳成功\");\r\n                alert(\"上傳成功!\");\r\n                const responseUrl = await getUserAvatar();\r\n                if(responseUrl) {\r\n                    setUserAvatar(responseUrl);\r\n                } else {\r\n                    alert(\"重載大頭貼時發生錯誤，請稍後再試\");\r\n                }\r\n            } else if (response.status === 400) {\r\n                const responseData = await response.json();\r\n                const error = responseData.message;\r\n                console.log(\"錯誤訊息\" + error);\r\n                alert(\"請上傳正確格式的圖片\");\r\n            } else {\r\n                const responseData = await response.json();\r\n                const error = responseData.message;\r\n                console.error(error);\r\n                alert(\"發生錯誤，請重新整理後再試一次\");\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error: \", error);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className={classes.avatarContainer}>\r\n            <div className={classes.avatarWrapper}>\r\n                <img src={userAvatar} alt=\"頭像\" className={classes.avatar} />\r\n                <div className={classes.overlay} onClick={avatarClickHandler}>\r\n                    <i className=\"fas fa-pen\" />\r\n                </div>\r\n                <input\r\n                    type=\"file\"\r\n                    id=\"fileInput\"\r\n                    accept=\"image/*\"\r\n                    style={{ display: \"none\" }}\r\n                    onChange={fileChangeHandler}\r\n                />\r\n\r\n                {showOption && (\r\n                    <div className={classes.avatarOptions}>\r\n                        <div className={classes.buttonContainer}>\r\n                            <img src={image} alt=\"查看\" />\r\n                            <button\r\n                                className={classes.button}\r\n                                onClick={viewModalHandler}\r\n                            >\r\n                                查看大頭貼\r\n                            </button>\r\n                        </div>\r\n                        <div className={classes.buttonContainer}>\r\n                            <img src={image_library} alt=\"更換\" />\r\n                            <button\r\n                                className={classes.button}\r\n                                onClick={changeAvatarHandler}\r\n                            >\r\n                                更換大頭貼\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className={classes.name}>{name}</div>\r\n            <div className={classes.account}>{account}</div>\r\n\r\n            {showModal && (\r\n                <div className={classes.modal} onClick={closeModalHandler}>\r\n                    <div\r\n                        className={classes.modalContent}\r\n                        onClick={(e) => e.stopPropagation()}\r\n                    >\r\n                        <img\r\n                            src={default_avatar200}\r\n                            alt=\"頭像\"\r\n                            className={classes.largeAvatar}\r\n                        />\r\n                        <span\r\n                            className={classes.closeButton}\r\n                            onClick={closeModalHandler}\r\n                        >\r\n                            &times;\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default UserInfoMainFrame;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}